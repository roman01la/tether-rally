# MediaMTX configuration with Cloudflare TURN

# Low latency settings
writeQueueSize: 128

# Enable REST API for recording control
api: yes
apiAddress: 127.0.0.1:9997

# Recording defaults (recording is started/stopped via API during races)
recordPath: /home/pi/recordings/%path_%Y-%m-%d_%H-%M-%S
recordFormat: fmp4
recordPartDuration: 2s
recordSegmentDuration: 1h

webrtcICEServers2:
  - url: stun:stun.cloudflare.com:3478
  - url: turn:turn.cloudflare.com:3478?transport=udp
    username: ...
    password: ...
  - url: turn:turn.cloudflare.com:3478?transport=tcp
    username: ...
    password: ...
  - url: turns:turn.cloudflare.com:443?transport=tcp
    username: ...
    password: ...

paths:
  cam:
    source: rpiCamera
    rpiCameraWidth: 1280
    rpiCameraHeight: 720
    rpiCameraFPS: 60
    rpiCameraBitrate: 3000000
    rpiCameraCodec: hardwareH264
    rpiCameraIDRPeriod: 30
    rpiCameraHardwareH264Profile: baseline
    rpiCameraDenoise: "off"
    rpiCameraEV: 0
    rpiCameraHDR: false
    rpiCameraAfMode: manual
    rpiCameraLensPosition: 0.1
    rpiCameraShutter: 10000
    rpiCameraGain: 4.0
    rpiCameraAWBGains: [2.0, 1.8]
    rpiCameraSharpness: 0
    rpiCameraContrast: 1
    rpiCameraSaturation: 1
    rpiCameraBrightness: 0

  # Back camera (IP camera RTSP stream for rear view PiP)
  # Uncomment and configure if you have a second camera
  # back:
  #   source: rtsp://192.168.0.18/ch0
  #   sourceOnDemand: true
