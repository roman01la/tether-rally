# ARRMA Big Rock 3S - Stock Ragnarok Tires Profile
#
# Original stock tires that came with the car
# - 110mm diameter (stock)
# - Lower grip than Badlands
#
# Weight: 4.2kg total (3.75kg car + 0.45kg battery)
#
# Original values before tuning for Badlands tires

[vehicle]
wheel_diameter_mm = 110
weight_kg = 4.2
wheelbase_m = 0.32
max_steering_angle_deg = 30.0

[heading_blend]
# Blend between IMU-only heading (low speed) and GPS-fused heading (high speed)
imu_only_speed_kmh = 5.0
gps_blend_speed_kmh = 15.0
heading_smooth_alpha = 0.3
imu_mount_offset_deg = 9.0

[speed_fusion]
# Primary speed source: wheel sensor with IMU integration
# GPS used only for drift correction
fusion_alpha = 0.15
imu_integrate_rate = 0.8
gps_drift_correction_alpha = 0.25
gps_drift_correction_min_speed_kmh = 5.0
wheelspin_detect_ratio = 1.5
wheelspin_detect_time_s = 0.3
wheelspin_max_fused_ratio = 1.2
stationary_timeout_s = 3.0
stationary_decay_rate = 0.5
imu_accel_noise_threshold = 0.3

[low_speed_traction]
# Unified low-speed traction (launch control + cruise slip)
# Higher target slip for lower grip tires
launch_phase_end_kmh = 5.0
transition_phase_end_kmh = 15.0
launch_target_slip = 0.10
launch_slip_tolerance = 0.03
launch_max_throttle_rate = 50
launch_throttle_ceiling = 800
launch_slip_high_cut = 0.8
cruise_slip_threshold = 0.20
cruise_throttle_cut_rate = 0.05
cruise_recovery_rate = 0.08
cruise_min_multiplier = 0.50
min_throttle_for_slip = 100
yaw_rate_threshold = 90.0
accel_smoothing = 0.3
gps_drift_correction_alpha = 0.01
gps_drift_correction_min_speed_kmh = 5.0

[yaw_rate_controller]
# ESC-lite yaw rate stability (oversteer/understeer detection)
# Lower grip_factor for stock tires (0.35 vs 0.50 for Badlands)
grip_factor = 0.35
min_speed_kmh = 5.0
oversteer_threshold = 35.0
understeer_threshold = 25.0
oversteer_cut_rate = 0.025
understeer_cut_rate = 0.015
min_throttle_mult = 0.50
recovery_rate = 0.05
fast_recovery_rate = 0.10
virtual_brake_enabled = true
virtual_brake_threshold = 50.0
max_virtual_brake = 400
yaw_smoothing = 0.4

[slip_angle_watchdog]
# IMU-based slip/drift detection (lateral accel excess)
# Lower threshold for stock tires (3.0 vs 4.0 m/sÂ²)
min_speed_kmh = 5.0
lateral_excess_threshold = 3.0
slip_duration_threshold_s = 0.20
min_throttle_for_intervention = 300
recovery_target = 0.6
reduction_rate = 0.05
recovery_rate = 0.08
min_multiplier = 0.5
smoothing_alpha = 0.3

[surface_adaptation]
# Adaptive grip estimation from driving behavior
# Lower default_grip assumption for stock tires
min_speed_kmh = 10.0
min_steering = 200
min_samples = 10
default_grip = 0.7
grip_smoothing = 0.05
grip_min = 0.2
grip_max = 1.2
history_size = 50

[hill_hold]
# Values for 4.2kg weight
pitch_threshold_deg = 5.0
speed_threshold_kmh = 2.0
throttle_deadzone = 100
hold_strength = 37
max_hold_force = 500
immediate_release_threshold = 300
blend_rate = 0.15
timeout_s = 30.0

[abs]
# Anti-lock braking (pulse modulation during forward braking)
# Lower slip threshold for stock tires (0.15 vs 0.18)
slip_threshold = 0.15
min_speed_kmh = 3.0
min_brake_input = 100
direction_hysteresis_kmh = 1.0
accel_direction_threshold = 0.5
cycle_time_ms = 50
brake_apply_ratio = 0.6
brake_release_ratio = 0.2

[coast_control]
# Smooth drag brake transition
release_threshold_high = 100
release_threshold_low = 50
coast_duration_s = 0.3
coast_throttle = 100
min_speed_kmh = 5.0

[steering_shaper]
# Latency-aware steering processing
max_steering_ratio = 1.0
min_steering_ratio = 0.5
low_speed_kmh = 8.0
high_speed_kmh = 40.0
max_rate = 300000
center_rate = 400000
counter_steer_enabled = true
counter_steer_min_yaw = 20.0
counter_steer_strength = 0.10
counter_steer_max_input = 5000
counter_steer_min_speed_kmh = 10.0
counter_steer_max_amount = 5000
smoothing_alpha = 0.7
